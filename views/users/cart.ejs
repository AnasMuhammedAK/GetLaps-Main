<%- include('../partials/head') %>
	<%- include('../partials/navbarmain') %>
		<!-- ajax for immediate response for change quantity btn -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		</head>
		<div class="colorlib-loader"></div>

		<div id="page">


			<div class="breadcrumbs">
				<div class="container">
					<div class="row">
						<div class="col">
							<h5 class="bread1"><span><a href="/">Home</a></span> / <span>Shopping Cart</span></h5>
						</div>
					</div>
				</div>
			</div>
			<%if(products.length>0){%>

			<div class="colorlib-product">
				<div class="container">
					<!-- <div class="row row-pb-lg">
						<div class="col-md-10 offset-md-1">
							<div class="process-wrap">
								<div class="process text-center active">
									<p><span style="color: green !important">01</span></p>
									<h6>Shopping Cart</h6>
								</div>
								<div class="process text-center">
									<p><span>02</span></p>
									<h6>Checkout</h6>
								</div>
								<div class="process text-center">
									<p><span>03</span></p>
									<h6>Order Complete</h6>
								</div>
							</div>
						</div>
					</div> -->
					
					<div class="container mt-5 ">
						<div class="row ">
						  <div style="margin: auto;border-radius: 20px;" class="col-12 col-md-10 hh-grayBox pt45 pb20 text-center">
							<div class="row justify-content-between">
							  <div class="order-tracking">
								<span class="is-complete"></span>
								<p>Shopping Cart<br><span></span></p>
							  </div>
							  <div class="order-tracking">
								<span class="is-complete"></span>
								<p>Checkout<br><span></span></p>
							  </div>
							  <div class="order-tracking">
								<span class="is-complete"></span>
								<p>Order Complete<br><span></span></p>
							  </div>
							</div>
						  </div>
						</div>
					  </div>
					<div class="row row-pb-lg">
						<div class="col-md-12">
							<div class="product-name d-flex">
								<div class="one-forth text-left px-4">
									<span>Product Details</span>
								</div>
								<div class="one-eight text-center">
									<span>Price</span>
								</div>
								<div class="one-eight text-center">
									<span>Quantity</span>
								</div>
								<div class="one-eight text-center">
									<span>Total</span>
								</div>
								<div class="one-eight text-center px-4">
									<span>Remove</span>
								</div>
							</div>
							<%if(products!=""){%>

								<% products.forEach((x)=> { %>
									<div class="product-cart d-flex">



										<div class="one-forth">
											<div class="product-img"
												style="background-image: url(/uploads/<%=x.product.image[0].image1%>);">
											</div>
											<div class="display-tc">
												<span>
													<%=x.product.title %>
												</span>
											</div>
										</div>
										<div class="one-eight text-center">
											<div class="display-tc">
												<span class="price">
													<%=x.product.price %>
												</span>
											</div>
										</div>


										<div class="one-eight text-center">
											<div class="display-tc mt-3 ">
												<button onclick="changeQuantity('<%=x._id%>','<%=x.product._id%>',1)"
													type="button" style="border: none;" class="bg-white mb-1"><img width="24px" src="https://cdn-icons-png.flaticon.com/512/1828/1828919.png" alt=""></button>
												<span type="text" id="<%=x.product._id%>"
													class="form-control input-number text-center" value="" min="1"
													max="100">
													<%=x.quantity%>
												</span>
												<button id="minus"
													onclick="changeQuantity('<%=x._id%>','<%=x.product._id%>',-1)"
													type="button" style="border: none;" class=" mt-1 bg-white "><img width="24px"  src="https://cdn-icons-png.flaticon.com/512/1828/1828899.png" alt=""></button>
											</div>
										</div>
										<div class="one-eight text-center">
											<div class="display-tc">
												<span id="<%=x.product._id%>subtotal" class="price">₹
													<%=x.product.price*x.quantity %>
												</span>
											</div>
										</div>
										<div class="one-eight text-center">
											<div class="display-tc">
												<button style="border: none;" onclick="deleteCartProduct('<%=x._id%>','<%=x.product._id%>')"
													class=" deleteButton bg-white"><img style="width: 30px;height: auto;" src="https://cdn-icons-png.flaticon.com/512/1828/1828851.png" alt=""></button>
											</div>
										</div>

									</div>
									<% }) %>
										<%}%>
						</div>
					</div>
					<div class="row row-pb-lg">
						<div class="col-md-12">
							<div class="total-wrap">
								<div class="row">
									<div class="col-sm-8">

									</div>
									<div class="col-sm-4 text-center">
										<div class="total">
											<div class="sub">
												<p><strong><span>Total:</span> <span id="ftotal">₹<%=total%>
														</span></strong></p>

												<p><span>Delivery Cost:</span> <span>₹0.00</span></p>
												<p><span>Discount:</span> <span id="discount">₹+<%=discount%></span></p>

											</div>
											<div class="grand-total">
												<p><span><strong>Total:</strong></span> <span id="total">₹<%=total%>
													</span></p>
											</div>
											<hr>
											<% if(products.length>0){%>
												<a class="btn btn-success mt-2" href="/place-order">Place Order</a>
												<%}else{%>
													<a class="btn btn-success mt-2" href="/shop">Go To Shopping</a>
													<%}%>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					
					<!-- <div class="row">
						<div class="col-md-3 col-lg-3 mb-4 text-center">
							<div class="product-entry border">
								<a href="#" class="prod-img">
									<img src="images/item-1.jpg" class="img-fluid"
										alt="Free html5 bootstrap 4 template">
								</a>
								<div class="desc">
									<h2><a href="#">Women's Boots Shoes Maca</a></h2>
									<span class="price">$139.00</span>
								</div>
							</div>
						</div>
						<div class="col-md-3 col-lg-3 mb-4 text-center">
							<div class="product-entry border">
								<a href="#" class="prod-img">
									<img src="images/item-2.jpg" class="img-fluid"
										alt="Free html5 bootstrap 4 template">
								</a>
								<div class="desc">
									<h2><a href="#">Women's Minam Meaghan</a></h2>
									<span class="price">$139.00</span>
								</div>
							</div>
						</div>
						<div class="col-md-3 col-lg-3 mb-4 text-center">
							<div class="product-entry border">
								<a href="#" class="prod-img">
									<img src="images/item-3.jpg" class="img-fluid"
										alt="Free html5 bootstrap 4 template">
								</a>
								<div class="desc">
									<h2><a href="#">Men's Taja Commissioner</a></h2>
									<span class="price">$139.00</span>
								</div>
							</div>
						</div>
						<div class="col-md-3 col-lg-3 mb-4 text-center">
							<div class="product-entry border">
								<a href="#" class="prod-img">
									<img src="images/item-4.jpg" class="img-fluid"
										alt="Free html5 bootstrap 4 template">
								</a>
								<div class="desc">
									<h2><a href="#">Russ Men's Sneakers</a></h2>
									<span class="price">$139.00</span>
								</div>
							</div>
						</div>
					</div> -->
				</div>
			</div>
			<%}else{%>
				<style>
					@import url(http://fonts.googleapis.com/css?family=Calibri:400,300,700);

					

					.mt-100 {
						margin-top: 100px;

					}


					.card {
						margin-bottom: 30px;
						border: 0;
						-webkit-transition: all .3s ease;
						transition: all .3s ease;
						letter-spacing: .5px;
						border-radius: 8px;
						-webkit-box-shadow: 1px 5px 24px 0 rgba(68, 102, 242, .05);
						box-shadow: 1px 5px 24px 0 rgba(68, 102, 242, .05);
					}

					.card .card-header {
						
						border-bottom: none;
						padding: 24px;
						
						border-top-left-radius: 8px;
						border-top-right-radius: 8px;
					}

					.card-header:first-child {
						border-radius: calc(.25rem - 1px) calc(.25rem - 1px) 0 0;
					}



					

					
				</style>
				<div style="height: 75vh;"  class="container-fluid   mt-100">
					<div  class="row" >

						<div  class="col-md-12">

							<div style="width: 50%;margin: auto;" class="card ">
								
								<div class="card-body cart">
									<div class="col-sm-12 empty-cart-cls text-center">
										<img src="https://i.imgur.com/dCdflKN.png" width="130" height="130"
											class="img-fluid mb-4 mr-3">
										<h3><strong>Your Cart is Empty</strong></h3>
										<h4>Add something to make me happy :)</h4>
										


									</div>
									<!-- <div class="col-sm-12 col-12  text-center" style="margin:auto">
										<a href="/shop" class="btn btn-primary  mr-3 "
											>continue shopping</a>
									</div> -->
								</div>
							</div>


						</div>

					</div>
					<div class="container text-center mt-3">
						<a class="btn btn-primary" href="/shop">Back To Shopping</a>
				</div>
				</div>
				
				
				<%}%>
			 <!-- Footer Section Begin -->
			 <%- include('../partials/userfooter') %>
			 <!-- Footer Section End -->
			<!--Sweet Alert CDN-->
			<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

			<script>
				function changeQuantity(cartId, proId, count) {

					let quantity = parseInt(document.getElementById(proId).innerHTML)

					count = parseInt(count)
					if (quantity == 1 && count == -1) {
						Swal.fire({
						title: 'Are you sure?',
						text: "You won't be able to revert this!",
						icon: 'warning',
						showCancelButton: true,
						confirmButtonColor: '#3085d6',
						cancelButtonColor: '#d33',
						confirmButtonText: 'Yes, delete it!'
					}).then((result) => {
						if (result.isConfirmed) {
							Swal.fire(
								'Deleted!',
								'Your file has been deleted.',
								'success'
							).then(() => {
								deleteProduct()
							})
						}
					})
					function deleteProduct(){
						$.ajax({
							url: '/changeProductQuandity/<%=userData._id%>',
							data: {

								cart: cartId,
								product: proId,
								count: count,
								quantity: quantity

							},
							method: 'post',
							success: (response) => {
								console.log(response)
								if (response.removeProduct) {

									location.reload()
								} else {
									document.getElementById(proId).innerHTML = quantity + count
									document.getElementById('ftotal').innerHTML = response.total
									document.getElementById('total').innerHTML = response.total
									document.getElementById(proId + 'subtotal').innerHTML = response.subTotal
									document.getElementById('discount').innerHTML = response.discount
								}
							}
						})
					}
						
					} else if (quantity >= 1) {
						$.ajax({
							url: '/changeProductQuandity/<%=userData._id%>',
							data: {

								cart: cartId,
								product: proId,
								count: count,
								quantity: quantity

							},
							method: 'post',
							success: (response) => {
								console.log(response)
								if (response.removeProduct) {

									location.reload()
								} else {


									document.getElementById(proId).innerHTML = quantity + count
									document.getElementById('ftotal').innerHTML = response.total
									document.getElementById('total').innerHTML = response.total
									document.getElementById(proId + 'subtotal').innerHTML = response.subTotal
									document.getElementById('discount').innerHTML = response.discount



								}
							}
						})
					}
				}

				function deleteCartProduct(cartId, proId) {
					Swal.fire({
						title: 'Are you sure?',
						text: "You won't be able to revert this!",
						icon: 'warning',
						showCancelButton: true,
						confirmButtonColor: '#3085d6',
						cancelButtonColor: '#d33',
						confirmButtonText: 'Yes, delete it!'
					}).then((result) => {
						if (result.isConfirmed) {
							Swal.fire(
								'Deleted!',
								'Your file has been deleted.',
								'success'
							).then(() => {
								deleted()
							})
						}
					})
					function deleted() {
						$.ajax({

							url: '/deleteCartProduct',
							data: {
								cart: cartId,
								product: proId
							},
							method: 'post',
							success: (response) => {
								if (response.removeProduct) {
									// alert('product deleted')
									location.reload()
								}
							}
						})
					}
				}
			</script>
			 <style>
				
		
				.hh-grayBox {
				 
				  margin-bottom: 20px;
				  padding: 35px;
				  margin-top: 20px;
				}
		
				.pt45 {
				  padding-top: 45px;
				}
		
				.order-tracking {
				  text-align: center;
				  width: 33.33%;
				  position: relative;
				  display: block;
				}
		
				.order-tracking .is-complete {
				  display: block;
				  position: relative;
				  border-radius: 50%;
				  height: 30px;
				  width: 30px;
				  border: 0px solid #AFAFAF;
				  background-color: #f7be16;
				  margin: 0 auto;
				  transition: background 0.25s linear;
				  -webkit-transition: background 0.25s linear;
				  z-index: 2;
				}
		
				.order-tracking .is-complete:after {
				  display: block;
				  position: absolute;
				  content: '';
				  height: 14px;
				  width: 7px;
				  top: -2px;
				  bottom: 0;
				  left: 5px;
				  margin: auto 0;
				  border: 0px solid #AFAFAF;
				  border-width: 0px 2px 2px 0;
				  transform: rotate(45deg);
				  opacity: 0;
				}
		
				.order-tracking.completed .is-complete {
				  border-color: #27aa80;
				  border-width: 0px;
				  background-color: #27aa80;
				}
		
				.order-tracking.completed .is-complete:after {
				  border-color: #fff;
				  border-width: 0px 3px 3px 0;
				  width: 7px;
				  left: 11px;
				  opacity: 1;
				}
		
				.order-tracking p {
				  color: #A4A4A4;
				  font-size: 16px;
				  margin-top: 8px;
				  margin-bottom: 0;
				  line-height: 20px;
				}
		
				.order-tracking p span {
				  font-size: 14px;
				}
		
				.order-tracking.completed p {
				  color: #000;
				}
		
				.order-tracking::before {
				  content: '';
				  display: block;
				  height: 3px;
				  width: calc(100% - 40px);
				  background-color: #f7be16;
				  top: 13px;
				  position: absolute;
				  left: calc(-50% + 20px);
				  z-index: 0;
				}
		
				.order-tracking:first-child:before {
				  display: none;
				}
		
				.order-tracking.completed:before {
				  background-color: #27aa80;
				}
			  </style>
		
			  
		
			  <script>
				var foo = "cart";
				var div = document.getElementsByClassName("order-tracking")
				if (foo == "cart") {
				  div[0].classList.add('completed')
				} else if (foo == "Shipped") {
				  div[0].classList.add('completed')
				  div[1].classList.add('completed')
				} else if (foo == "Delivered") {
				  div[0].classList.add('completed')
				  div[1].classList.add('completed')
				  div[2].classList.add('completed')
				}
			  </script>

			<%- include('../partials/foot') %>